<!DOCTYPE html>
<html>
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Ruby LSP documentation</title>

  <script type="text/javascript">
    var rdoc_rel_prefix = "./";
    var index_rel_prefix = "./";
  </script>

  <script src="./js/search_index.js" defer></script>
  <script src="./js/snapper.js" defer></script>
  <link href="./css/snapper.css" rel="stylesheet">
</head>

  <body>
    <div id="main-container">
  <nav id="nav">
  <h3 class="title">Ruby LSP documentation</h3>

  <input id="side-search" type="text" placeholder="Search docs (CMD/CTRL + K)"></input>

  <ul id="navigation-list">
    <li id="getting-started"><a href="./index.html">Getting started</a></li>
    <p class="separator">PAGES</p>
    <li class="index-entry">
  <a href="./ADDONS_md.html">
    ADDONS
  </a>
</li>
<li class="index-entry">
  <a href="./CODE_OF_CONDUCT_md.html">
    CODE_OF_CONDUCT
  </a>
</li>
<li class="index-entry">
  <a href="./CONTRIBUTING_md.html">
    CONTRIBUTING
  </a>
</li>
<li class="index-entry">
  <a href="./DESIGN_AND_ROADMAP_md.html">
    DESIGN_AND_ROADMAP
  </a>
</li>
<li class="index-entry">
  <a href="./EDITORS_md.html">
    EDITORS
  </a>
</li>
<li class="index-entry">
  <a href="./README_md.html">
    README
  </a>
</li>
<li class="index-entry">
  <a href="./SEMANTIC_HIGHLIGHTING_md.html">
    SEMANTIC_HIGHLIGHTING
  </a>
</li>
<li class="index-entry">
  <a href="./TROUBLESHOOTING_md.html">
    TROUBLESHOOTING
  </a>
</li>
<li class="index-entry">
  <a href="./VERSION_MANAGERS_md.html">
    VERSION_MANAGERS
  </a>
</li>

    <p class="separator">CODE</p>
    <li class="expandable-index-entry">
  <details>
    <summary><a href="./RuboCop.html">RuboCop</a></summary>
    <ul>
      <li class="expandable-index-entry">
  <details>
    <summary><a href="./RuboCop/Cop.html">Cop</a></summary>
    <ul>
      <li class="expandable-index-entry">
  <details>
    <summary><a href="./RuboCop/Cop/RubyLsp.html">RubyLsp</a></summary>
    <ul>
      <li class="index-entry"><a href="./RuboCop/Cop/RubyLsp/UseLanguageServerAliases.html">UseLanguageServerAliases</a></li><li class="index-entry"><a href="./RuboCop/Cop/RubyLsp/UseRegisterWithHandlerMethod.html">UseRegisterWithHandlerMethod</a></li>
    </ul>
  </details>
</li>

    </ul>
  </details>
</li>

    </ul>
  </details>
</li>
<li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyIndexer.html">RubyIndexer</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyIndexer/ClassesAndModulesTest.html">ClassesAndModulesTest</a></li><li class="index-entry"><a href="./RubyIndexer/Configuration.html">Configuration</a></li><li class="index-entry"><a href="./RubyIndexer/ConfigurationTest.html">ConfigurationTest</a></li><li class="index-entry"><a href="./RubyIndexer/ConstantTest.html">ConstantTest</a></li><li class="index-entry"><a href="./RubyIndexer/DeclarationListener.html">DeclarationListener</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyIndexer/Entry.html">Entry</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyIndexer/Entry/Accessor.html">Accessor</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Alias.html">Alias</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/BlockParameter.html">BlockParameter</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Class.html">Class</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Constant.html">Constant</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Include.html">Include</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/InstanceVariable.html">InstanceVariable</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/KeywordParameter.html">KeywordParameter</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/KeywordRestParameter.html">KeywordRestParameter</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Member.html">Member</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Method.html">Method</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/MethodAlias.html">MethodAlias</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Module.html">Module</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/ModuleOperation.html">ModuleOperation</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Namespace.html">Namespace</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/OptionalKeywordParameter.html">OptionalKeywordParameter</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/OptionalParameter.html">OptionalParameter</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Parameter.html">Parameter</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Prepend.html">Prepend</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/RequiredParameter.html">RequiredParameter</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/RestParameter.html">RestParameter</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Signature.html">Signature</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/SingletonClass.html">SingletonClass</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/UnresolvedAlias.html">UnresolvedAlias</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/UnresolvedMethodAlias.html">UnresolvedMethodAlias</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Visibility.html">Visibility</a></li>
    </ul>
  </details>
</li>
<li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyIndexer/Index.html">Index</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyIndexer/Index/NonExistingNamespaceError.html">NonExistingNamespaceError</a></li><li class="index-entry"><a href="./RubyIndexer/Index/UnresolvableAliasError.html">UnresolvableAliasError</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyIndexer/IndexTest.html">IndexTest</a></li><li class="index-entry"><a href="./RubyIndexer/IndexablePath.html">IndexablePath</a></li><li class="index-entry"><a href="./RubyIndexer/InstanceVariableTest.html">InstanceVariableTest</a></li><li class="index-entry"><a href="./RubyIndexer/Location.html">Location</a></li><li class="index-entry"><a href="./RubyIndexer/MethodTest.html">MethodTest</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyIndexer/PrefixTree.html">PrefixTree</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyIndexer/PrefixTree/Node.html">Node</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyIndexer/PrefixTreeTest.html">PrefixTreeTest</a></li><li class="index-entry"><a href="./RubyIndexer/RBSIndexer.html">RBSIndexer</a></li><li class="index-entry"><a href="./RubyIndexer/RBSIndexerTest.html">RBSIndexerTest</a></li><li class="index-entry"><a href="./RubyIndexer/TestCase.html">TestCase</a></li>
    </ul>
  </details>
</li>
<li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp.html">RubyLsp</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/Addon.html">Addon</a></li><li class="index-entry"><a href="./RubyLsp/BaseServer.html">BaseServer</a></li><li class="index-entry"><a href="./RubyLsp/CheckDocs.html">CheckDocs</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/Document.html">Document</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/Document/LanguageId.html">LanguageId</a></li><li class="index-entry"><a href="./RubyLsp/Document/Scanner.html">Scanner</a></li>
    </ul>
  </details>
</li>
<li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/ERBDocument.html">ERBDocument</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/ERBDocument/ERBScanner.html">ERBScanner</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/Error.html">Error</a></li><li class="index-entry"><a href="./RubyLsp/GlobalState.html">GlobalState</a></li><li class="index-entry"><a href="./RubyLsp/InlineTypeAssertions.html">InlineTypeAssertions</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/Listeners.html">Listeners</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/Listeners/CodeLens.html">CodeLens</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/Completion.html">Completion</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/Definition.html">Definition</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/DocumentHighlight.html">DocumentHighlight</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/DocumentLink.html">DocumentLink</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/DocumentSymbol.html">DocumentSymbol</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/FoldingRanges.html">FoldingRanges</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/Hover.html">Hover</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/InlayHints.html">InlayHints</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/SemanticHighlighting.html">SemanticHighlighting</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/SignatureHelp.html">SignatureHelp</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/Message.html">Message</a></li><li class="index-entry"><a href="./RubyLsp/NodeContext.html">NodeContext</a></li><li class="index-entry"><a href="./RubyLsp/Notification.html">Notification</a></li><li class="index-entry"><a href="./RubyLsp/ParameterScope.html">ParameterScope</a></li><li class="index-entry"><a href="./RubyLsp/Request.html">Request</a></li><li class="index-entry"><a href="./RubyLsp/RequestConfig.html">RequestConfig</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/Requests.html">Requests</a></summary>
    <ul>
      <li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/Requests/CodeActionResolve.html">CodeActionResolve</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/Requests/CodeActionResolve/CodeActionError.html">CodeActionError</a></li><li class="index-entry"><a href="./RubyLsp/Requests/CodeActionResolve/Error.html">Error</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/Requests/CodeActions.html">CodeActions</a></li><li class="index-entry"><a href="./RubyLsp/Requests/CodeLens.html">CodeLens</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Completion.html">Completion</a></li><li class="index-entry"><a href="./RubyLsp/Requests/CompletionResolve.html">CompletionResolve</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Definition.html">Definition</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Diagnostics.html">Diagnostics</a></li><li class="index-entry"><a href="./RubyLsp/Requests/DocumentHighlight.html">DocumentHighlight</a></li><li class="index-entry"><a href="./RubyLsp/Requests/DocumentLink.html">DocumentLink</a></li><li class="index-entry"><a href="./RubyLsp/Requests/DocumentSymbol.html">DocumentSymbol</a></li><li class="index-entry"><a href="./RubyLsp/Requests/FoldingRanges.html">FoldingRanges</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/Requests/Formatting.html">Formatting</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/Requests/Formatting/Error.html">Error</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/Requests/Hover.html">Hover</a></li><li class="index-entry"><a href="./RubyLsp/Requests/InlayHints.html">InlayHints</a></li><li class="index-entry"><a href="./RubyLsp/Requests/OnTypeFormatting.html">OnTypeFormatting</a></li><li class="index-entry"><a href="./RubyLsp/Requests/PrepareTypeHierarchy.html">PrepareTypeHierarchy</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/Requests/Request.html">Request</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/Requests/Request/InvalidFormatter.html">InvalidFormatter</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/Requests/SelectionRanges.html">SelectionRanges</a></li><li class="index-entry"><a href="./RubyLsp/Requests/SemanticHighlighting.html">SemanticHighlighting</a></li><li class="index-entry"><a href="./RubyLsp/Requests/ShowSyntaxTree.html">ShowSyntaxTree</a></li><li class="index-entry"><a href="./RubyLsp/Requests/SignatureHelp.html">SignatureHelp</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/Requests/Support.html">Support</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/Requests/Support/Annotation.html">Annotation</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Support/Common.html">Common</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Support/Formatter.html">Formatter</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Support/InternalRuboCopError.html">InternalRuboCopError</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Support/RuboCopDiagnostic.html">RuboCopDiagnostic</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Support/RuboCopFormatter.html">RuboCopFormatter</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/Requests/Support/RuboCopRunner.html">RuboCopRunner</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/Requests/Support/RuboCopRunner/ConfigurationError.html">ConfigurationError</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/Requests/Support/SelectionRange.html">SelectionRange</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Support/Sorbet.html">Sorbet</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Support/SyntaxTreeFormatter.html">SyntaxTreeFormatter</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/Requests/TypeHierarchySupertypes.html">TypeHierarchySupertypes</a></li><li class="index-entry"><a href="./RubyLsp/Requests/WorkspaceSymbol.html">WorkspaceSymbol</a></li>
    </ul>
  </details>
</li>
<li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/ResponseBuilders.html">ResponseBuilders</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/ResponseBuilders/CollectionResponseBuilder.html">CollectionResponseBuilder</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/ResponseBuilders/DocumentSymbol.html">DocumentSymbol</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/ResponseBuilders/DocumentSymbol/SymbolHierarchyRoot.html">SymbolHierarchyRoot</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/ResponseBuilders/Hover.html">Hover</a></li><li class="index-entry"><a href="./RubyLsp/ResponseBuilders/ResponseBuilder.html">ResponseBuilder</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/ResponseBuilders/SemanticHighlighting.html">SemanticHighlighting</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/ResponseBuilders/SemanticHighlighting/SemanticToken.html">SemanticToken</a></li><li class="index-entry"><a href="./RubyLsp/ResponseBuilders/SemanticHighlighting/SemanticTokenEncoder.html">SemanticTokenEncoder</a></li><li class="index-entry"><a href="./RubyLsp/ResponseBuilders/SemanticHighlighting/UndefinedTokenType.html">UndefinedTokenType</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/ResponseBuilders/SignatureHelp.html">SignatureHelp</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/Result.html">Result</a></li><li class="index-entry"><a href="./RubyLsp/RubyDocument.html">RubyDocument</a></li><li class="index-entry"><a href="./RubyLsp/Server.html">Server</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/SetupBundler.html">SetupBundler</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/SetupBundler/BundleInstallFailure.html">BundleInstallFailure</a></li><li class="index-entry"><a href="./RubyLsp/SetupBundler/BundleNotLocked.html">BundleNotLocked</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/Store.html">Store</a></li><li class="index-entry"><a href="./RubyLsp/TestHelper.html">TestHelper</a></li><li class="index-entry"><a href="./RubyLsp/TypeInferrer.html">TypeInferrer</a></li>
    </ul>
  </details>
</li>
<li class="expandable-index-entry">
  <details>
    <summary><a href="./URI.html">URI</a></summary>
    <ul>
      <li class="index-entry"><a href="./URI/Generic.html">Generic</a></li><li class="index-entry"><a href="./URI/Source.html">Source</a></li>
    </ul>
  </details>
</li>

  </ul>
</nav>

  <article>
<h1 id="label-Troubleshooting">Troubleshooting<span><a href="#label-Troubleshooting">&para;</a> <a href="#top">&uarr;</a></span></h1>

<h2 id="label-How+the+Ruby+LSP+activation+works">How the Ruby LSP activation works<span><a href="#label-How+the+Ruby+LSP+activation+works">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>The Ruby LSP extension runs inside VS Code’s NodeJS runtime, like any other VS Code extension. This means that environment variables that are properly set in your shell may not exist inside the NodeJS process. To run the LSP server with the same Ruby version as your projects, we need to properly set these environment variables, which is done by invoking your Ruby version manager.</p>

<p>The extension runs a command using your shell’s interactive mode, so that version managers configured in files such as <code>~/.zshrc</code> are picked up automatically. The command then exports the environment information into JSON, so that we can inject it into the NodeJS process and appropriately set the Ruby version and gem installation paths.</p>

<p>As an example, the activation script for <code>zsh</code> using <code>rbenv</code> as a version manager will look something like this:</p>

<pre># Invoke zsh using interactive mode (loads ~/.zshrc) to run a single command
# The command is `rbenv exec ruby`, which automatically sets all relevant environment variables and selects the
# specified Ruby version
# We then print the activated environment as JSON. We read that JSON from the NodeJS process to insert the needed
# environment variables in order to run Ruby correctly
/bin/zsh -ic &#39;rbenv exec ruby -rjson -e &quot;puts JSON.dump(ENV.to_h)&quot;&#39;</pre>

<p>After activating the Ruby version, we then proceed to boot the server gem (<code>ruby-lsp</code>). To avoid having users include the <code>ruby-lsp</code> in their <code>Gemfile</code>, we currently create a custom bundle under the <code>.ruby-lsp</code> directory inside your project. That directory contains another <code>Gemfile</code>, that includes the <code>ruby-lsp</code> gem in addition to your project’s dependencies. This approach allows us to automatically detect which formatter your project uses and which gems we need to index for features such as go to definition.</p>

<blockquote>
<p><img src="NOTE"> We are working with the RubyGems/Bundler team to have this type of mechanism properly supported from within Bundler itself, which is currently being experimented with in a plugin called <code>bundler-compose</code>. Once <code>bundler-compose</code>is production ready, the entire custom bundle created under the <code>.ruby-lsp</code> directory will go away and we’ll rely on Bundler to compose the LOAD_PATH including the <code>ruby-lsp</code> gem.</p>
</blockquote>

<h2 id="label-Common+issues">Common issues<span><a href="#label-Common+issues">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>There are two main sources of issues users typically face during activation: shell or Bundler related problems.</p>

<h3 id="label-Shell+issues">Shell issues<span><a href="#label-Shell+issues">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>When the extension invokes the shell and loads its config file (<code>~/.zshrc</code>, <code>~/.bashrc</code>, etc), it is susceptible to issues that may be caused by how the shell or its plugins interact with the NodeJS process. For example</p>
<ul><li>
<p>Some plugins completely redirect the stderr pipe to implement their functionality (fixed on the Ruby LSP side by <a href="https://github.com/Shopify/vscode-ruby-lsp/pull/918">github.com/Shopify/vscode-ruby-lsp/pull/918</a>)</p>
</li><li>
<p>Some plugins fail immediately or end up in an endless loop if they detect there’s no UI attached to the shell process. In this case, it’s not possible to fix from the Ruby LSP side since a shell invoked by NodeJS will never have a UI</p>
</li></ul>

<p>Additionally, some users experience an issue where VS Code selects the wrong shell, not respecting the <code>SHELL</code> environment variable. This usually ends up in having <code>/bin/sh</code> selected instead of your actual shell. If you are facing this problem, please try to</p>
<ul><li>
<p>Update VS Code to the latest version</p>
</li><li>
<p>Completely close VS Code and launch it from the terminal with <code>code .</code> (instead of opening VS Code from the launch icon)</p>
</li></ul>

<p>More context about this issue on <a href="https://github.com/Shopify/vscode-ruby-lsp/issues/901">github.com/Shopify/vscode-ruby-lsp/issues/901</a>.</p>

<h3 id="label-Bundler+issues">Bundler issues<span><a href="#label-Bundler+issues">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>If the extension successfully activated the Ruby environment, it may still fail when trying to compose the custom bundle to run the server gem. This could be a regular Bundler issue, like not being able to satisfy dependencies due to a conflicting version requirement, or it could be a configuration issue.</p>

<p>For example, if the project has its linter/formatter put in an optional <code>Gemfile</code> group and that group is excluded in the Bundler configuration, the Ruby LSP will not be able to see those gems.</p>

<pre class="ruby"><span class="ruby-comment"># Gemfile</span>

<span class="ruby-comment"># ...</span>

<span class="ruby-comment"># If Bundler is configured to exclude this group, the Ruby LSP will not be able to find `rubocop`</span>
<span class="ruby-identifier">group</span> <span class="ruby-value">:optional_group</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">gem</span> <span class="ruby-string">&quot;rubocop&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>If you experience Bundler related issues, double-check both your global and project-specific configuration to check if there’s anything that could be preventing the server from booting. You can print your Bundler configuration with</p>

<pre class="ruby"><span class="ruby-identifier">bundle</span> <span class="ruby-identifier">config</span>
</pre>

<h3 id="label-Format+on+save+dialogue+won-27t+disappear">Format on save dialogue won’t disappear<span><a href="#label-Format+on+save+dialogue+won-27t+disappear">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>When VS Code requests formatting for a document, it opens a dialogue showing progress a couple of seconds after sending the request, closing it once the server has responded with the formatting result.</p>

<p>If you are seeing that the dialogue is not going away, this likely doesn’t mean that formatting is taking very long or hanging. It likely means that the server crashed or got into a corrupt state and is simply not responding to any requests, which means the dialogue will never go away.</p>

<p>This is always the result of a bug in the server. It should always fail gracefully without getting into a corrupt state that prevents it from responding to new requests coming from the editor. If you encounter this, please submit a bug report <a href="https://github.com/Shopify/ruby-lsp/issues/new?labels=bug&amp;template=bug_template.yml">here</a> including the steps that led to the server getting stuck.</p>

<h3 id="label-Gem+installation+locations+and+permissions">Gem installation locations and permissions<span><a href="#label-Gem+installation+locations+and+permissions">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>To launch the Ruby LSP server, the <code>ruby-lsp</code> gem must be installed. And in order to automatically index your project’s dependencies, they must also be installed so that we can read, parse and analyze their source files. The <code>ruby-lsp</code> gem is installed via <code>gem install</code> (using RubyGems). The project dependencies are installed via <code>bundle install</code> (using Bundler).</p>

<p>If you use a non-default path to install your gems, please remember that RubyGems and Bundler require separate configurations to achieve that.</p>

<p>For example, if you configure <code>BUNDLE_PATH</code> to point to <code>vendor/bundle</code> so that gems are installed inside the same directory as your project, <code>bundle install</code> will automatically pick that up and install them in the right place. But <code>gem install</code> will not as it requires a different setting to achieve it.</p>

<p>You can apply your prefered installed locations for RubyGems by using the <code>~/.gemrc</code> file. In that file, you can decide to either install it with <code>--user-install</code> or select a specific installation directory with <code>--install-dir</code>.</p>

<pre>gem: --user-install
# Or
gem: --install-dir /my/preferred/path/for/gem/install</pre>

<p>One scenario where this is useful is if the user doesn’t have permissions for the default gem installation directory and <code>gem install</code> fails. For example, when using the system Ruby on certain Linux distributions.</p>

<blockquote>
<p><img src="NOTE"> Using non-default gem installation paths may lead to other integration issues with version managers. For example, for Ruby 3.3.1 the default <code>GEM_HOME</code> is <code>~/.gem/ruby/3.3.0</code> (without the patch part of the version). However, <code>chruby</code> (and potentially other version managers) override <code>GEM_HOME</code> to include the version patch resulting in <code>~/.gem/ruby/3.3.1</code>. When you install a gem using <code>gem install --user-install</code>, RubyGems ignores the <code>GEM_HOME</code> override and installs the gem inside <code>~/.gem/ruby/3.3.0</code>. This results in executables not being found because <code>chruby</code> modified the <code>PATH</code> to only include executables installed under <code>~/.gem/ruby/3.3.1</code>.</p>

<p>Similarly, the majority of version managers don’t read your <code>~/.gemrc</code> configurations. If you use a custom installation with <code>--install-dir</code>, it’s unlikely that the version manager will know about it. This may result in the gem executables not being found.</p>

<p>Incompatibilities between RubyGems and version managers like this one are beyond the scope of the Ruby LSP and should be reported either to RubyGems or the respective version manager.</p>
</blockquote>

<h3 id="label-Developing+on+containers">Developing on containers<span><a href="#label-Developing+on+containers">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>See the <a href="vscode/README_md.html#developing-on-containers">documentation</a>.</p>

<h2 id="label-Diagnosing+the+problem">Diagnosing the problem<span><a href="#label-Diagnosing+the+problem">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Many activation issues are specific to how your development environment is configured. If you can reproduce the problem you are seeing, including information about these steps is the best way to ensure that we can fix the issue in a timely manner. Please include the steps taken to diagnose in your bug report.</p>

<h3 id="label-Check+if+the+server+is+running">Check if the server is running<span><a href="#label-Check+if+the+server+is+running">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Check the <img src="https://github.com/Shopify/ruby-lsp/blob/main/vscode/extras/ruby_lsp_status_center.png" />. Does the server status say it’s running? If it is running, but you are missing certain features, please check our <a href="https://shopify.github.io/ruby-lsp/RubyLsp/Requests.html">documentation</a> to ensure we already added support for it.</p>

<p>If the feature is listed as fully supported, but not working for you, report <a href="https://github.com/Shopify/ruby-lsp/issues/new?labels=bug&amp;projects=&amp;template=bug_template.yml">an issue</a> so that we can assist.</p>

<h3 id="label-Check+the+VS+Code+output+tab">Check the VS Code output tab<span><a href="#label-Check+the+VS+Code+output+tab">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Many of the activation steps taken are logged in the <code>Ruby LSP</code> channel of VS Code’s <code>Output</code> tab. Check the logs to see if any entries hint at what the issue might be. Did the extension select your preferred shell?</p>

<p>Did it select your preferred version manager? You can define which version manager to use with the <code>&quot;rubyLsp.rubyVersionManager&quot;</code> setting.</p>

<h3 id="label-Enable+logging">Enable logging<span><a href="#label-Enable+logging">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>You can enable logging to the VS Code output tab, <a href="CONTRIBUTING_md.html#tracing-lsp-requests-and-responses">as described in the CONTRIBUTING</a> docs.</p>

<h3 id="label-Environment+activation+failed">Environment activation failed<span><a href="#label-Environment+activation+failed">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>We listed version manager related information and tips in this <a href="VERSION_MANAGERS_md.html">documentation</a>.</p>

<h3 id="label-My+preferred+version+manager+is+not+supported">My preferred version manager is not supported<span><a href="#label-My+preferred+version+manager+is+not+supported">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>We default to supporting the most common version managers, but that may not cover every single tool available. For these cases, we offer custom activation support. More context in the version manager <a href="VERSION_MANAGERS_md.html#custom-activation">documentation</a>.</p>

<h3 id="label-Try+to+run+the+Ruby+activation+manually">Try to run the Ruby activation manually<span><a href="#label-Try+to+run+the+Ruby+activation+manually">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>If the extension is failing to activate the Ruby environment, try running the same command manually in your shell to see if the issue is exclusively related with the extension. The exact command used for activation is printed to the output tab.</p>

<h3 id="label-Try+booting+the+server+manually">Try booting the server manually<span><a href="#label-Try+booting+the+server+manually">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>If the Ruby environment seems to activate properly, but the server won’t boot, try to launch is manually from the terminal with</p>

<pre class="ruby"><span class="ruby-comment"># Do not use bundle exec</span>
<span class="ruby-identifier">ruby</span><span class="ruby-operator">-</span><span class="ruby-identifier">lsp</span>
</pre>

<p>Is there any extra information given from booting the server manually? Or does it only fail when booting through the extension?</p>

<h2 id="label-After+troubleshooting">After troubleshooting<span><a href="#label-After+troubleshooting">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>If after troubleshooting the Ruby LSP is still not initializing properly, please report an issue <a href="https://github.com/Shopify/ruby-lsp/issues/new?labels=bug&amp;template=bug_template.yml">here</a> so that we can assist in fixing the problem. Remember to include the steps taken when trying to diagnose the issue.</p>
</article>
  <div class="right-section">
  <nav class="right-nav">
    <span id="right-side-bar-title" class="right-side-bar-title">On this page</span>
      <ul>
        <li> <a href=#>TROUBLESHOOTING.md</a></li>

            <div class="nav-section">

              <ul class="link-list" role="directory">
                                    <li>
                      <details open>
                        <summary>                <a href="#label-Troubleshooting">Troubleshooting</a>
</summary>
                        <ul class="link-list" role="directory">
                                              <li>                <a href="#label-How+the+Ruby+LSP+activation+works">How the Ruby LSP activation works</a>
                    <li>
                      <details open>
                        <summary>                <a href="#label-Common+issues">Common issues</a>
</summary>
                        <ul class="link-list" role="directory">
                                              <li>                <a href="#label-Shell+issues">Shell issues</a>
                    <li>                <a href="#label-Bundler+issues">Bundler issues</a>
                    <li>                <a href="#label-Format+on+save+dialogue+won-27t+disappear">Format on save dialogue won’t disappear</a>
                    <li>                <a href="#label-Gem+installation+locations+and+permissions">Gem installation locations and permissions</a>
                    <li>                <a href="#label-Developing+on+containers">Developing on containers</a>

                        </ul>
                      </details>
                    </li>
                    <li>
                      <details open>
                        <summary>                <a href="#label-Diagnosing+the+problem">Diagnosing the problem</a>
</summary>
                        <ul class="link-list" role="directory">
                                              <li>                <a href="#label-Check+if+the+server+is+running">Check if the server is running</a>
                    <li>                <a href="#label-Check+the+VS+Code+output+tab">Check the VS Code output tab</a>
                    <li>                <a href="#label-Enable+logging">Enable logging</a>
                    <li>                <a href="#label-Environment+activation+failed">Environment activation failed</a>
                    <li>                <a href="#label-My+preferred+version+manager+is+not+supported">My preferred version manager is not supported</a>
                    <li>                <a href="#label-Try+to+run+the+Ruby+activation+manually">Try to run the Ruby activation manually</a>
                    <li>                <a href="#label-Try+booting+the+server+manually">Try booting the server manually</a>

                        </ul>
                      </details>
                    </li>
                    <li>                <a href="#label-After+troubleshooting">After troubleshooting</a>

                        </ul>
                      </details>
                    </li>

              </ul>
            </div>
  </nav>
</div>

</div>

<div id="search-modal">
  <div id="search-modal-content">
    <input id="search-modal-input" type="text" placeholder="Search"></input>
    <ul id="search-results"></ul>
  </div>
</div>


    <footer>
      <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.6.3.1
    </footer>
  </body>
</html>
