<!DOCTYPE html>
<html>
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Ruby LSP documentation</title>

  <script type="text/javascript">
    var rdoc_rel_prefix = "./";
    var index_rel_prefix = "./";
  </script>

  <script src="./js/search_index.js" defer></script>
  <script src="./js/snapper.js" defer></script>
  <link href="./css/snapper.css" rel="stylesheet">
</head>

  <body>
    <div id="main-container">
  <nav id="nav">
  <h3 class="title">Ruby LSP documentation</h3>

  <input id="side-search" type="text" placeholder="Search docs (CMD/CTRL + K)"></input>

  <ul id="navigation-list">
    <li id="getting-started"><a href="./index.html">Getting started</a></li>
    <p class="separator">PAGES</p>
    <li class="index-entry">
  <a href="./ADDONS_md.html">
    ADDONS
  </a>
</li>
<li class="index-entry">
  <a href="./CODE_OF_CONDUCT_md.html">
    CODE_OF_CONDUCT
  </a>
</li>
<li class="index-entry">
  <a href="./CONTRIBUTING_md.html">
    CONTRIBUTING
  </a>
</li>
<li class="index-entry">
  <a href="./DESIGN_AND_ROADMAP_md.html">
    DESIGN_AND_ROADMAP
  </a>
</li>
<li class="index-entry">
  <a href="./EDITORS_md.html">
    EDITORS
  </a>
</li>
<li class="index-entry">
  <a href="./README_md.html">
    README
  </a>
</li>
<li class="index-entry">
  <a href="./SEMANTIC_HIGHLIGHTING_md.html">
    SEMANTIC_HIGHLIGHTING
  </a>
</li>
<li class="index-entry">
  <a href="./TROUBLESHOOTING_md.html">
    TROUBLESHOOTING
  </a>
</li>
<li class="index-entry">
  <a href="./VERSION_MANAGERS_md.html">
    VERSION_MANAGERS
  </a>
</li>

    <p class="separator">CODE</p>
    <li class="expandable-index-entry">
  <details>
    <summary><a href="./RuboCop.html">RuboCop</a></summary>
    <ul>
      <li class="expandable-index-entry">
  <details>
    <summary><a href="./RuboCop/Cop.html">Cop</a></summary>
    <ul>
      <li class="expandable-index-entry">
  <details>
    <summary><a href="./RuboCop/Cop/RubyLsp.html">RubyLsp</a></summary>
    <ul>
      <li class="index-entry"><a href="./RuboCop/Cop/RubyLsp/UseLanguageServerAliases.html">UseLanguageServerAliases</a></li><li class="index-entry"><a href="./RuboCop/Cop/RubyLsp/UseRegisterWithHandlerMethod.html">UseRegisterWithHandlerMethod</a></li>
    </ul>
  </details>
</li>

    </ul>
  </details>
</li>

    </ul>
  </details>
</li>
<li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyIndexer.html">RubyIndexer</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyIndexer/ClassesAndModulesTest.html">ClassesAndModulesTest</a></li><li class="index-entry"><a href="./RubyIndexer/Configuration.html">Configuration</a></li><li class="index-entry"><a href="./RubyIndexer/ConfigurationTest.html">ConfigurationTest</a></li><li class="index-entry"><a href="./RubyIndexer/ConstantTest.html">ConstantTest</a></li><li class="index-entry"><a href="./RubyIndexer/DeclarationListener.html">DeclarationListener</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyIndexer/Entry.html">Entry</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyIndexer/Entry/Accessor.html">Accessor</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Alias.html">Alias</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/BlockParameter.html">BlockParameter</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Class.html">Class</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Constant.html">Constant</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Include.html">Include</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/InstanceVariable.html">InstanceVariable</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/KeywordParameter.html">KeywordParameter</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/KeywordRestParameter.html">KeywordRestParameter</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Member.html">Member</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Method.html">Method</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/MethodAlias.html">MethodAlias</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Module.html">Module</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/ModuleOperation.html">ModuleOperation</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Namespace.html">Namespace</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/OptionalKeywordParameter.html">OptionalKeywordParameter</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/OptionalParameter.html">OptionalParameter</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Parameter.html">Parameter</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Prepend.html">Prepend</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/RequiredParameter.html">RequiredParameter</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/RestParameter.html">RestParameter</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Signature.html">Signature</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/SingletonClass.html">SingletonClass</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/UnresolvedAlias.html">UnresolvedAlias</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/UnresolvedMethodAlias.html">UnresolvedMethodAlias</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Visibility.html">Visibility</a></li>
    </ul>
  </details>
</li>
<li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyIndexer/Index.html">Index</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyIndexer/Index/NonExistingNamespaceError.html">NonExistingNamespaceError</a></li><li class="index-entry"><a href="./RubyIndexer/Index/UnresolvableAliasError.html">UnresolvableAliasError</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyIndexer/IndexTest.html">IndexTest</a></li><li class="index-entry"><a href="./RubyIndexer/IndexablePath.html">IndexablePath</a></li><li class="index-entry"><a href="./RubyIndexer/InstanceVariableTest.html">InstanceVariableTest</a></li><li class="index-entry"><a href="./RubyIndexer/Location.html">Location</a></li><li class="index-entry"><a href="./RubyIndexer/MethodTest.html">MethodTest</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyIndexer/PrefixTree.html">PrefixTree</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyIndexer/PrefixTree/Node.html">Node</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyIndexer/PrefixTreeTest.html">PrefixTreeTest</a></li><li class="index-entry"><a href="./RubyIndexer/RBSIndexer.html">RBSIndexer</a></li><li class="index-entry"><a href="./RubyIndexer/RBSIndexerTest.html">RBSIndexerTest</a></li><li class="index-entry"><a href="./RubyIndexer/TestCase.html">TestCase</a></li>
    </ul>
  </details>
</li>
<li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp.html">RubyLsp</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/Addon.html">Addon</a></li><li class="index-entry"><a href="./RubyLsp/BaseServer.html">BaseServer</a></li><li class="index-entry"><a href="./RubyLsp/CheckDocs.html">CheckDocs</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/Document.html">Document</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/Document/LanguageId.html">LanguageId</a></li><li class="index-entry"><a href="./RubyLsp/Document/Scanner.html">Scanner</a></li>
    </ul>
  </details>
</li>
<li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/ERBDocument.html">ERBDocument</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/ERBDocument/ERBScanner.html">ERBScanner</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/Error.html">Error</a></li><li class="index-entry"><a href="./RubyLsp/GlobalState.html">GlobalState</a></li><li class="index-entry"><a href="./RubyLsp/InlineTypeAssertions.html">InlineTypeAssertions</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/Listeners.html">Listeners</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/Listeners/CodeLens.html">CodeLens</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/Completion.html">Completion</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/Definition.html">Definition</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/DocumentHighlight.html">DocumentHighlight</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/DocumentLink.html">DocumentLink</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/DocumentSymbol.html">DocumentSymbol</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/FoldingRanges.html">FoldingRanges</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/Hover.html">Hover</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/InlayHints.html">InlayHints</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/SemanticHighlighting.html">SemanticHighlighting</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/SignatureHelp.html">SignatureHelp</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/Message.html">Message</a></li><li class="index-entry"><a href="./RubyLsp/NodeContext.html">NodeContext</a></li><li class="index-entry"><a href="./RubyLsp/Notification.html">Notification</a></li><li class="index-entry"><a href="./RubyLsp/ParameterScope.html">ParameterScope</a></li><li class="index-entry"><a href="./RubyLsp/Request.html">Request</a></li><li class="index-entry"><a href="./RubyLsp/RequestConfig.html">RequestConfig</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/Requests.html">Requests</a></summary>
    <ul>
      <li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/Requests/CodeActionResolve.html">CodeActionResolve</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/Requests/CodeActionResolve/CodeActionError.html">CodeActionError</a></li><li class="index-entry"><a href="./RubyLsp/Requests/CodeActionResolve/Error.html">Error</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/Requests/CodeActions.html">CodeActions</a></li><li class="index-entry"><a href="./RubyLsp/Requests/CodeLens.html">CodeLens</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Completion.html">Completion</a></li><li class="index-entry"><a href="./RubyLsp/Requests/CompletionResolve.html">CompletionResolve</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Definition.html">Definition</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Diagnostics.html">Diagnostics</a></li><li class="index-entry"><a href="./RubyLsp/Requests/DocumentHighlight.html">DocumentHighlight</a></li><li class="index-entry"><a href="./RubyLsp/Requests/DocumentLink.html">DocumentLink</a></li><li class="index-entry"><a href="./RubyLsp/Requests/DocumentSymbol.html">DocumentSymbol</a></li><li class="index-entry"><a href="./RubyLsp/Requests/FoldingRanges.html">FoldingRanges</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/Requests/Formatting.html">Formatting</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/Requests/Formatting/Error.html">Error</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/Requests/Hover.html">Hover</a></li><li class="index-entry"><a href="./RubyLsp/Requests/InlayHints.html">InlayHints</a></li><li class="index-entry"><a href="./RubyLsp/Requests/OnTypeFormatting.html">OnTypeFormatting</a></li><li class="index-entry"><a href="./RubyLsp/Requests/PrepareTypeHierarchy.html">PrepareTypeHierarchy</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/Requests/Request.html">Request</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/Requests/Request/InvalidFormatter.html">InvalidFormatter</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/Requests/SelectionRanges.html">SelectionRanges</a></li><li class="index-entry"><a href="./RubyLsp/Requests/SemanticHighlighting.html">SemanticHighlighting</a></li><li class="index-entry"><a href="./RubyLsp/Requests/ShowSyntaxTree.html">ShowSyntaxTree</a></li><li class="index-entry"><a href="./RubyLsp/Requests/SignatureHelp.html">SignatureHelp</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/Requests/Support.html">Support</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/Requests/Support/Annotation.html">Annotation</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Support/Common.html">Common</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Support/Formatter.html">Formatter</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Support/InternalRuboCopError.html">InternalRuboCopError</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Support/RuboCopDiagnostic.html">RuboCopDiagnostic</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Support/RuboCopFormatter.html">RuboCopFormatter</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/Requests/Support/RuboCopRunner.html">RuboCopRunner</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/Requests/Support/RuboCopRunner/ConfigurationError.html">ConfigurationError</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/Requests/Support/SelectionRange.html">SelectionRange</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Support/Sorbet.html">Sorbet</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Support/SyntaxTreeFormatter.html">SyntaxTreeFormatter</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/Requests/TypeHierarchySupertypes.html">TypeHierarchySupertypes</a></li><li class="index-entry"><a href="./RubyLsp/Requests/WorkspaceSymbol.html">WorkspaceSymbol</a></li>
    </ul>
  </details>
</li>
<li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/ResponseBuilders.html">ResponseBuilders</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/ResponseBuilders/CollectionResponseBuilder.html">CollectionResponseBuilder</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/ResponseBuilders/DocumentSymbol.html">DocumentSymbol</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/ResponseBuilders/DocumentSymbol/SymbolHierarchyRoot.html">SymbolHierarchyRoot</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/ResponseBuilders/Hover.html">Hover</a></li><li class="index-entry"><a href="./RubyLsp/ResponseBuilders/ResponseBuilder.html">ResponseBuilder</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/ResponseBuilders/SemanticHighlighting.html">SemanticHighlighting</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/ResponseBuilders/SemanticHighlighting/SemanticToken.html">SemanticToken</a></li><li class="index-entry"><a href="./RubyLsp/ResponseBuilders/SemanticHighlighting/SemanticTokenEncoder.html">SemanticTokenEncoder</a></li><li class="index-entry"><a href="./RubyLsp/ResponseBuilders/SemanticHighlighting/UndefinedTokenType.html">UndefinedTokenType</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/ResponseBuilders/SignatureHelp.html">SignatureHelp</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/Result.html">Result</a></li><li class="index-entry"><a href="./RubyLsp/RubyDocument.html">RubyDocument</a></li><li class="index-entry"><a href="./RubyLsp/Server.html">Server</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/SetupBundler.html">SetupBundler</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/SetupBundler/BundleInstallFailure.html">BundleInstallFailure</a></li><li class="index-entry"><a href="./RubyLsp/SetupBundler/BundleNotLocked.html">BundleNotLocked</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/Store.html">Store</a></li><li class="index-entry"><a href="./RubyLsp/TestHelper.html">TestHelper</a></li><li class="index-entry"><a href="./RubyLsp/TypeInferrer.html">TypeInferrer</a></li>
    </ul>
  </details>
</li>
<li class="expandable-index-entry">
  <details>
    <summary><a href="./URI.html">URI</a></summary>
    <ul>
      <li class="index-entry"><a href="./URI/Generic.html">Generic</a></li><li class="index-entry"><a href="./URI/Source.html">Source</a></li>
    </ul>
  </details>
</li>

  </ul>
</nav>

  <article>
<h1 id="label-Ruby+LSP+design+and+roadmap">Ruby LSP design and roadmap<span><a href="#label-Ruby+LSP+design+and+roadmap">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p><a href="#design-principles">Design principles</a></p>
<ul><li>
<p><a href="#favoring-common-development-setups">Favoring common development setups</a></p>
</li><li>
<p><a href="#stability-and-performance-over-features">Stability and performance over features</a></p>
</li><li>
<p><a href="#accuracy-correctness-and-type-checking">Accuracy, correctness and type checking</a></p>
</li><li>
<p><a href="#extensibility">Extensibility</a></p>
</li><li>
<p><a href="#relying-on-bundler">Relying on Bundler</a></p>
</li></ul>
</li><li>
<p><a href="#long-term-roadmap">Long term roadmap</a></p>
</li></ul>

<h2 id="label-Design+principles">Design principles<span><a href="#label-Design+principles">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>These are the mental models used to make decisions in respect to the Ruby LSP.</p>

<h3 id="label-Favoring+common+development+setups">Favoring common development setups<span><a href="#label-Favoring+common+development+setups">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>There are infinite ways in which one can configure their development environment. Not only is there a vast combination of tools that one can use (such as shells, plugins, version managers, operating systems and so on), but many tools allow for customization to alter their default behaviors.</p>

<p>While there is no “right way” to use Ruby and configure the development environment, we have to draw a line somewhere in terms of what the Ruby LSP can support. Trying to account for every different setup and customization diverts efforts from improving the experience for the larger audience and increases the long term maintenance costs.</p>

<p><strong>Example</strong>: the <a href="https://rails-hosting.com/2022/#ruby-rails-version-updates">Ruby on Rails Community survey</a> reports that only 2% of developers are not using a version manager to install and configure their Ruby versions. While the popularity of each version manager varies, it’s reasonable to consider that using a version manager is the common way of working with Ruby.</p>

<p>Based on this, we will always: - Favor more common development setups and ways of working with Ruby - Favor defaults and conventions over customization - Aim to deliver a zero-configuration experience for common setups - Provide flexibility where possible as long as it does not compromise the default experience</p>

<h3 id="label-Stability+and+performance+over+features">Stability and performance over features<span><a href="#label-Stability+and+performance+over+features">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Adding a more complete set of editor features or improving correctness is always desired. However, we will always prioritize the stability and the performance of Ruby LSP over adding new features.</p>

<p>Even if a feature is useful or if a modification improves the correctness of existing functionality, if it degrades performance and negatively impacts the responsiveness of the editor it may actually result in a worse developer experience.</p>

<p><strong>Example</strong>: the Ruby syntax for constant references is ambiguous. It’s not possible to tell if a reference to <code>Foo</code> is referring to a class, a module or a constant just based on the syntax alone. Therefore, we started the semantic highlighting feature considering all constant references as namespaces, which is the token type available that more closely represents the three possibilities.</p>

<p>To improve highlighting correctness, the Ruby LSP must resolve the references to figure out to which declaration they point to, so that we can assign the correct token type (class, namespace or constant). However, semantic highlighting is executed on every keypress and resolving constant references is an expensive operation - which could lead to lag in the editor. We may decide to not correct this behavior intentionally in favor of maintaining responsiveness.</p>

<h3 id="label-Accuracy-2C+correctness+and+type+checking">Accuracy, correctness and type checking<span><a href="#label-Accuracy-2C+correctness+and+type+checking">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>The Ruby LSP does not ship with a type system. It performs static analysis with some level of type checking, but falls back to built-in heuristics for scenarios where type annotations would be necessary.</p>

<p>That means that it will provide accurate results where possible and fallback to simpler behavior in situations where a complete type system would be needed, delegating decisions to the user. Additionally, performance over features also governs accuracy. We may prefer showing a list of options to let the user decide instead of increasing the complexity of an implementation or degrading the overall LSP performance.</p>

<p>If you require more accuracy in your editor, consider adopting a type system and type checker, such as <a href="https://sorbet.org/">Sorbet</a> or <a href="https://github.com/soutaro/steep">Steep</a>.</p>

<p>This applies to multiple language server features such as go to definition, hover, completion and automated refactors. Consider the following examples:</p>

<blockquote>
<p>[!NOTE] not all of the examples below are supported at the moment and this is not an exhaustive list. Please check the long term roadmap to see what’s planned</p>
</blockquote>

<pre class="ruby"><span class="ruby-comment"># Cases where we can provide a satisfactory experience without a type system</span>

<span class="ruby-comment">## Literals</span>
<span class="ruby-string">&quot;&quot;</span>.<span class="ruby-identifier">upcase</span>
<span class="ruby-value">1</span>.<span class="ruby-identifier">to_s</span>
{}.<span class="ruby-identifier">merge!</span>({ <span class="ruby-value">a:</span> <span class="ruby-value">1</span> })
[].<span class="ruby-identifier">push</span>(<span class="ruby-value">1</span>)

<span class="ruby-comment">## Scenarios where can assume the receiver type</span>
<span class="ruby-keyword">class</span> <span class="ruby-constant">Foo</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">bar</span>; <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">baz</span>
    <span class="ruby-identifier">bar</span> <span class="ruby-comment"># method invoked directly on self</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment">## Singleton methods with an explicit receiver</span>
<span class="ruby-constant">Foo</span>.<span class="ruby-identifier">some_singleton_method</span>

<span class="ruby-comment">## Constant references</span>
<span class="ruby-constant">Foo</span><span class="ruby-operator">::</span><span class="ruby-constant">Bar</span>

<span class="ruby-comment"># Cases where a type system would be required and we fallback to heuristics to provide features</span>

<span class="ruby-comment">## Meta-programming</span>
<span class="ruby-constant">Foo</span>.<span class="ruby-identifier">define_method</span>(<span class="ruby-node">&quot;some#{interpolation}&quot;</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">arg</span><span class="ruby-operator">|</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment">## Methods invoked on the return values of other methods</span>
<span class="ruby-comment">## Not possible to provide accurate features without knowing the return type</span>
<span class="ruby-comment">## of invoke_foo</span>
<span class="ruby-identifier">var</span> = <span class="ruby-identifier">invoke_foo</span>
<span class="ruby-identifier">var</span>.<span class="ruby-identifier">upcase</span> <span class="ruby-comment"># &lt;- not accurate</span>

<span class="ruby-comment">## Same thing for chained method calls</span>
<span class="ruby-comment">## To know where the definition of `baz` is, we need to know the return type</span>
<span class="ruby-comment">## of `foo` and `bar`</span>
<span class="ruby-identifier">foo</span>.<span class="ruby-identifier">bar</span>.<span class="ruby-identifier">baz</span>
</pre>

<p><strong>Example</strong>: when using refactoring features you may be prompted to confirm a code modification as it could be incorrect. Or when trying to go to the definition of a method, you may be prompted with all declarations that match the method call’s name and arguments instead of jumping to the correct one directly.</p>

<p>As another fallback mechanism, we want to explore using variable or method call names as a type hint to assist accuracy (not yet implemented). For example</p>

<pre class="ruby"><span class="ruby-comment"># Typically, a type annotation for `find` would be necessary to discover</span>
<span class="ruby-comment"># that the type of the `user` variable is `User`, allowing the LSP to</span>
<span class="ruby-comment"># find the declaration of `do_something`.</span>
<span class="ruby-comment">#</span>
<span class="ruby-comment"># If we consider the variable name as a snake_case version of its type</span>
<span class="ruby-comment"># we may be able to improve accuracy and deliver a nicer experience even</span>
<span class="ruby-comment"># without the adoption of a type system</span>
<span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>)
<span class="ruby-identifier">user</span>.<span class="ruby-identifier">do_something</span>
</pre>

<h3 id="label-Extensibility">Extensibility<span><a href="#label-Extensibility">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>In an effort to reduce tooling fragmentation in the Ruby ecosystem, we are experimenting with an addon system for the Ruby LSP server. This allows other gems to enhance the Ruby LSP’s functionality without having to write a complete language server of their own, avoiding handling text synchronization, implementing features that depend exclusively on syntax (such as folding range) or caring about the editor’s encoding.</p>

<p>We believe that a less fragmented tooling ecosystem leads to a better user experience that requires less configuration and consolidates efforts from the community.</p>

<p>Our goal is to allow the Ruby LSP to connect to different formatters, linters, type checkers or even extract runtime information from running applications like Rails servers. You can learn more in the <a href="ADDONS_md.html">addons documentation</a>.</p>

<h3 id="label-Relying+on+Bundler">Relying on Bundler<span><a href="#label-Relying+on+Bundler">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Understanding the dependencies of projects where the Ruby LSP is being used on allows it to provide a zero configuration experience to users. It can automatically figure out which gems have to be indexed to provide features like go to definition or completion. That also allows it to connect to the formatter/linter being used, without asking for any configuration.</p>

<p>To make that work, the Ruby LSP relies on Bundler, Ruby’s official dependency manager. This decision allows the LSP to easily get information about dependencies, but it also means that it is subject to how Bundler works.</p>

<p><strong>Example</strong>: gems need to be installed on the Ruby version used by the project for the Ruby LSP to find it (bundle install needs to be satisfied). It needs to be the same Ruby version because otherwise Bundler might resolve to a different set of versions for those dependencies, which could result in failure to install due to version constraints or the LSP indexing the incorrect version of a gem (which could lead to surfacing constants that do not exist in the version used by the project).</p>

<p><strong>Example</strong>: if we tried to run the Ruby LSP without the context of the project’s bundle, then we would not be able to require gems from it. Bundler only adds dependencies that are part of the current bundle to the load path. Ignoring the project’s bundle would make the LSP unable to require tools like <a href="RuboCop.html"><code>RuboCop</code></a> and its extensions.</p>

<p>Based on this, we will always: - Rely on Bundler to provide dependency information - Focus our efforts on Bundler integrations and helping improve Bundler itself - Only support other dependency management tools if it does not compromise the default experience through Bundler</p>

<h2 id="label-Long+term+roadmap">Long term roadmap<span><a href="#label-Long+term+roadmap">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>The goal of this roadmap is to bring visibility into what we have planned for the Ruby LSP. This is not an exhaustive task list, but rather large milestones we wish to achieve.</p>

<p>Please note that there are no guarantees about the order in which entries will be implemented or if they will be implemented at all given that we may uncover blockers along the way.</p>

<p>Interested in contributing? Check out the issues tagged with <a href="https://github.com/Shopify/ruby-lsp/issues?q=is%3Aopen+is%3Aissue+label%3Ahelp-wanted">help-wanted</a> or <a href="https://github.com/Shopify/ruby-lsp/issues?q=is%3Aopen+is%3Aissue+label%3Agood-first-issue">good-first-issue</a>.</p>
<ul><li>
<p><a href="https://github.com/Shopify/vscode-ruby-lsp/pull/923">Make Ruby environment activation more flexible and less coupled with shells</a></p>
</li><li>
<p>Stabilize APIs for Ruby LSP addons to allow other gems to enhance the base features</p>
</li><li>
<p><a href="https://github.com/Shopify/ruby-lsp/issues/899">Full method support for definition, hover and completion</a></p>
</li><li>
<p><a href="https://github.com/Shopify/ruby-lsp/issues/1333">Improve accuracy of method features by handling class/module hierarchies</a></p>
</li><li>
<p><a href="https://github.com/Shopify/ruby-lsp/issues/1334">Improve accuracy of test code lens by checking which class a method inherits from</a></p>
</li><li>
<p>Explore using variable/method call names as a type hint</p>
</li><li>
<p><a href="https://github.com/Shopify/ruby-lsp/issues/1335">Develop strategy to index declarations made in native extensions or C code. For example, Ruby’s own Core classes</a></p>
</li><li>
<p><a href="https://github.com/Shopify/ruby-lsp/issues/202">Add find references support</a></p>
</li><li>
<p><a href="https://github.com/Shopify/ruby-lsp/issues/57">Add rename support</a></p>
</li><li>
<p><a href="https://github.com/Shopify/ruby-lsp/issues/1046">Add show type hierarchy support</a></p>
</li><li>
<p><a href="https://github.com/Shopify/vscode-ruby-lsp/pull/464">Show index view on the VS Code extension allowing users to browse indexed gems</a></p>
</li><li>
<p>Remove custom bundle in favor of using bundler-compose</p>
</li><li>
<p><a href="https://github.com/Shopify/ruby-lsp/issues/60">Add more refactoring code actions such as extract to method, extract to class/module, etc</a></p>
</li><li>
<p><a href="https://github.com/Shopify/ruby-lsp/issues/1009">Explore speeding up indexing by caching the index for gems</a></p>
</li><li>
<p>Explore speeding up indexing by making Prism AST allocations lazy</p>
</li><li>
<p><a href="https://github.com/Shopify/ruby-lsp/issues/203">Add range formatting support for formatters that do support it</a></p>
</li><li>
<p><a href="https://github.com/Shopify/ruby-lsp/issues/1055">Add ERB support</a></p>
</li><li>
<p>Explore allowing addons to add support for arbitrary file types</p>
</li><li>
<p>Allow the Ruby LSP to connect to a typechecker addon to improve accuracy</p>
</li><li>
<p>Make the Ruby LSP’s default functionality act as a fallback for the more accurate typechecker results</p>
</li></ul>
</article>
  <div class="right-section">
  <nav class="right-nav">
    <span id="right-side-bar-title" class="right-side-bar-title">On this page</span>
      <ul>
        <li> <a href=#>DESIGN_AND_ROADMAP.md</a></li>

            <div class="nav-section">

              <ul class="link-list" role="directory">
                                    <li>
                      <details open>
                        <summary>                <a href="#label-Ruby+LSP+design+and+roadmap">Ruby LSP design and roadmap</a>
</summary>
                        <ul class="link-list" role="directory">
                                              <li>
                      <details open>
                        <summary>                <a href="#label-Design+principles">Design principles</a>
</summary>
                        <ul class="link-list" role="directory">
                                              <li>                <a href="#label-Favoring+common+development+setups">Favoring common development setups</a>
                    <li>                <a href="#label-Stability+and+performance+over+features">Stability and performance over features</a>
                    <li>                <a href="#label-Accuracy-2C+correctness+and+type+checking">Accuracy, correctness and type checking</a>
                    <li>                <a href="#label-Extensibility">Extensibility</a>
                    <li>                <a href="#label-Relying+on+Bundler">Relying on Bundler</a>

                        </ul>
                      </details>
                    </li>
                    <li>                <a href="#label-Long+term+roadmap">Long term roadmap</a>

                        </ul>
                      </details>
                    </li>

              </ul>
            </div>
  </nav>
</div>

</div>

<div id="search-modal">
  <div id="search-modal-content">
    <input id="search-modal-input" type="text" placeholder="Search"></input>
    <ul id="search-results"></ul>
  </div>
</div>


    <footer>
      <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.6.3.1
    </footer>
  </body>
</html>
