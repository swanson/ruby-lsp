<!DOCTYPE html>
<html>
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Ruby LSP documentation</title>

  <script type="text/javascript">
    var rdoc_rel_prefix = "./";
    var index_rel_prefix = "./";
  </script>

  <script src="./js/search_index.js" defer></script>
  <script src="./js/snapper.js" defer></script>
  <link href="./css/snapper.css" rel="stylesheet">
</head>

  <body>
    <div id="main-container">
  <nav id="nav">
  <h3 class="title">Ruby LSP documentation</h3>

  <input id="side-search" type="text" placeholder="Search docs (CMD/CTRL + K)"></input>

  <ul id="navigation-list">
    <li id="getting-started"><a href="./index.html">Getting started</a></li>
    <p class="separator">PAGES</p>
    <li class="index-entry">
  <a href="./ADDONS_md.html">
    ADDONS
  </a>
</li>
<li class="index-entry">
  <a href="./CODE_OF_CONDUCT_md.html">
    CODE_OF_CONDUCT
  </a>
</li>
<li class="index-entry">
  <a href="./CONTRIBUTING_md.html">
    CONTRIBUTING
  </a>
</li>
<li class="index-entry">
  <a href="./DESIGN_AND_ROADMAP_md.html">
    DESIGN_AND_ROADMAP
  </a>
</li>
<li class="index-entry">
  <a href="./EDITORS_md.html">
    EDITORS
  </a>
</li>
<li class="index-entry">
  <a href="./README_md.html">
    README
  </a>
</li>
<li class="index-entry">
  <a href="./SEMANTIC_HIGHLIGHTING_md.html">
    SEMANTIC_HIGHLIGHTING
  </a>
</li>
<li class="index-entry">
  <a href="./TROUBLESHOOTING_md.html">
    TROUBLESHOOTING
  </a>
</li>
<li class="index-entry">
  <a href="./VERSION_MANAGERS_md.html">
    VERSION_MANAGERS
  </a>
</li>

    <p class="separator">CODE</p>
    <li class="expandable-index-entry">
  <details>
    <summary><a href="./RuboCop.html">RuboCop</a></summary>
    <ul>
      <li class="expandable-index-entry">
  <details>
    <summary><a href="./RuboCop/Cop.html">Cop</a></summary>
    <ul>
      <li class="expandable-index-entry">
  <details>
    <summary><a href="./RuboCop/Cop/RubyLsp.html">RubyLsp</a></summary>
    <ul>
      <li class="index-entry"><a href="./RuboCop/Cop/RubyLsp/UseLanguageServerAliases.html">UseLanguageServerAliases</a></li><li class="index-entry"><a href="./RuboCop/Cop/RubyLsp/UseRegisterWithHandlerMethod.html">UseRegisterWithHandlerMethod</a></li>
    </ul>
  </details>
</li>

    </ul>
  </details>
</li>

    </ul>
  </details>
</li>
<li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyIndexer.html">RubyIndexer</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyIndexer/ClassesAndModulesTest.html">ClassesAndModulesTest</a></li><li class="index-entry"><a href="./RubyIndexer/Configuration.html">Configuration</a></li><li class="index-entry"><a href="./RubyIndexer/ConfigurationTest.html">ConfigurationTest</a></li><li class="index-entry"><a href="./RubyIndexer/ConstantTest.html">ConstantTest</a></li><li class="index-entry"><a href="./RubyIndexer/DeclarationListener.html">DeclarationListener</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyIndexer/Entry.html">Entry</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyIndexer/Entry/Accessor.html">Accessor</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Alias.html">Alias</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/BlockParameter.html">BlockParameter</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Class.html">Class</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Constant.html">Constant</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Include.html">Include</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/InstanceVariable.html">InstanceVariable</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/KeywordParameter.html">KeywordParameter</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/KeywordRestParameter.html">KeywordRestParameter</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Member.html">Member</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Method.html">Method</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/MethodAlias.html">MethodAlias</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Module.html">Module</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/ModuleOperation.html">ModuleOperation</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Namespace.html">Namespace</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/OptionalKeywordParameter.html">OptionalKeywordParameter</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/OptionalParameter.html">OptionalParameter</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Parameter.html">Parameter</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Prepend.html">Prepend</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/RequiredParameter.html">RequiredParameter</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/RestParameter.html">RestParameter</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Signature.html">Signature</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/SingletonClass.html">SingletonClass</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/UnresolvedAlias.html">UnresolvedAlias</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/UnresolvedMethodAlias.html">UnresolvedMethodAlias</a></li><li class="index-entry"><a href="./RubyIndexer/Entry/Visibility.html">Visibility</a></li>
    </ul>
  </details>
</li>
<li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyIndexer/Index.html">Index</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyIndexer/Index/NonExistingNamespaceError.html">NonExistingNamespaceError</a></li><li class="index-entry"><a href="./RubyIndexer/Index/UnresolvableAliasError.html">UnresolvableAliasError</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyIndexer/IndexTest.html">IndexTest</a></li><li class="index-entry"><a href="./RubyIndexer/IndexablePath.html">IndexablePath</a></li><li class="index-entry"><a href="./RubyIndexer/InstanceVariableTest.html">InstanceVariableTest</a></li><li class="index-entry"><a href="./RubyIndexer/Location.html">Location</a></li><li class="index-entry"><a href="./RubyIndexer/MethodTest.html">MethodTest</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyIndexer/PrefixTree.html">PrefixTree</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyIndexer/PrefixTree/Node.html">Node</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyIndexer/PrefixTreeTest.html">PrefixTreeTest</a></li><li class="index-entry"><a href="./RubyIndexer/RBSIndexer.html">RBSIndexer</a></li><li class="index-entry"><a href="./RubyIndexer/RBSIndexerTest.html">RBSIndexerTest</a></li><li class="index-entry"><a href="./RubyIndexer/TestCase.html">TestCase</a></li>
    </ul>
  </details>
</li>
<li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp.html">RubyLsp</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/Addon.html">Addon</a></li><li class="index-entry"><a href="./RubyLsp/BaseServer.html">BaseServer</a></li><li class="index-entry"><a href="./RubyLsp/CheckDocs.html">CheckDocs</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/Document.html">Document</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/Document/LanguageId.html">LanguageId</a></li><li class="index-entry"><a href="./RubyLsp/Document/Scanner.html">Scanner</a></li>
    </ul>
  </details>
</li>
<li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/ERBDocument.html">ERBDocument</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/ERBDocument/ERBScanner.html">ERBScanner</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/Error.html">Error</a></li><li class="index-entry"><a href="./RubyLsp/GlobalState.html">GlobalState</a></li><li class="index-entry"><a href="./RubyLsp/InlineTypeAssertions.html">InlineTypeAssertions</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/Listeners.html">Listeners</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/Listeners/CodeLens.html">CodeLens</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/Completion.html">Completion</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/Definition.html">Definition</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/DocumentHighlight.html">DocumentHighlight</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/DocumentLink.html">DocumentLink</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/DocumentSymbol.html">DocumentSymbol</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/FoldingRanges.html">FoldingRanges</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/Hover.html">Hover</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/InlayHints.html">InlayHints</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/SemanticHighlighting.html">SemanticHighlighting</a></li><li class="index-entry"><a href="./RubyLsp/Listeners/SignatureHelp.html">SignatureHelp</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/Message.html">Message</a></li><li class="index-entry"><a href="./RubyLsp/NodeContext.html">NodeContext</a></li><li class="index-entry"><a href="./RubyLsp/Notification.html">Notification</a></li><li class="index-entry"><a href="./RubyLsp/ParameterScope.html">ParameterScope</a></li><li class="index-entry"><a href="./RubyLsp/Request.html">Request</a></li><li class="index-entry"><a href="./RubyLsp/RequestConfig.html">RequestConfig</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/Requests.html">Requests</a></summary>
    <ul>
      <li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/Requests/CodeActionResolve.html">CodeActionResolve</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/Requests/CodeActionResolve/CodeActionError.html">CodeActionError</a></li><li class="index-entry"><a href="./RubyLsp/Requests/CodeActionResolve/Error.html">Error</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/Requests/CodeActions.html">CodeActions</a></li><li class="index-entry"><a href="./RubyLsp/Requests/CodeLens.html">CodeLens</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Completion.html">Completion</a></li><li class="index-entry"><a href="./RubyLsp/Requests/CompletionResolve.html">CompletionResolve</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Definition.html">Definition</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Diagnostics.html">Diagnostics</a></li><li class="index-entry"><a href="./RubyLsp/Requests/DocumentHighlight.html">DocumentHighlight</a></li><li class="index-entry"><a href="./RubyLsp/Requests/DocumentLink.html">DocumentLink</a></li><li class="index-entry"><a href="./RubyLsp/Requests/DocumentSymbol.html">DocumentSymbol</a></li><li class="index-entry"><a href="./RubyLsp/Requests/FoldingRanges.html">FoldingRanges</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/Requests/Formatting.html">Formatting</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/Requests/Formatting/Error.html">Error</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/Requests/Hover.html">Hover</a></li><li class="index-entry"><a href="./RubyLsp/Requests/InlayHints.html">InlayHints</a></li><li class="index-entry"><a href="./RubyLsp/Requests/OnTypeFormatting.html">OnTypeFormatting</a></li><li class="index-entry"><a href="./RubyLsp/Requests/PrepareTypeHierarchy.html">PrepareTypeHierarchy</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/Requests/Request.html">Request</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/Requests/Request/InvalidFormatter.html">InvalidFormatter</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/Requests/SelectionRanges.html">SelectionRanges</a></li><li class="index-entry"><a href="./RubyLsp/Requests/SemanticHighlighting.html">SemanticHighlighting</a></li><li class="index-entry"><a href="./RubyLsp/Requests/ShowSyntaxTree.html">ShowSyntaxTree</a></li><li class="index-entry"><a href="./RubyLsp/Requests/SignatureHelp.html">SignatureHelp</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/Requests/Support.html">Support</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/Requests/Support/Annotation.html">Annotation</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Support/Common.html">Common</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Support/Formatter.html">Formatter</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Support/InternalRuboCopError.html">InternalRuboCopError</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Support/RuboCopDiagnostic.html">RuboCopDiagnostic</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Support/RuboCopFormatter.html">RuboCopFormatter</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/Requests/Support/RuboCopRunner.html">RuboCopRunner</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/Requests/Support/RuboCopRunner/ConfigurationError.html">ConfigurationError</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/Requests/Support/SelectionRange.html">SelectionRange</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Support/Sorbet.html">Sorbet</a></li><li class="index-entry"><a href="./RubyLsp/Requests/Support/SyntaxTreeFormatter.html">SyntaxTreeFormatter</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/Requests/TypeHierarchySupertypes.html">TypeHierarchySupertypes</a></li><li class="index-entry"><a href="./RubyLsp/Requests/WorkspaceSymbol.html">WorkspaceSymbol</a></li>
    </ul>
  </details>
</li>
<li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/ResponseBuilders.html">ResponseBuilders</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/ResponseBuilders/CollectionResponseBuilder.html">CollectionResponseBuilder</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/ResponseBuilders/DocumentSymbol.html">DocumentSymbol</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/ResponseBuilders/DocumentSymbol/SymbolHierarchyRoot.html">SymbolHierarchyRoot</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/ResponseBuilders/Hover.html">Hover</a></li><li class="index-entry"><a href="./RubyLsp/ResponseBuilders/ResponseBuilder.html">ResponseBuilder</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/ResponseBuilders/SemanticHighlighting.html">SemanticHighlighting</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/ResponseBuilders/SemanticHighlighting/SemanticToken.html">SemanticToken</a></li><li class="index-entry"><a href="./RubyLsp/ResponseBuilders/SemanticHighlighting/SemanticTokenEncoder.html">SemanticTokenEncoder</a></li><li class="index-entry"><a href="./RubyLsp/ResponseBuilders/SemanticHighlighting/UndefinedTokenType.html">UndefinedTokenType</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/ResponseBuilders/SignatureHelp.html">SignatureHelp</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/Result.html">Result</a></li><li class="index-entry"><a href="./RubyLsp/RubyDocument.html">RubyDocument</a></li><li class="index-entry"><a href="./RubyLsp/Server.html">Server</a></li><li class="expandable-index-entry">
  <details>
    <summary><a href="./RubyLsp/SetupBundler.html">SetupBundler</a></summary>
    <ul>
      <li class="index-entry"><a href="./RubyLsp/SetupBundler/BundleInstallFailure.html">BundleInstallFailure</a></li><li class="index-entry"><a href="./RubyLsp/SetupBundler/BundleNotLocked.html">BundleNotLocked</a></li>
    </ul>
  </details>
</li>
<li class="index-entry"><a href="./RubyLsp/Store.html">Store</a></li><li class="index-entry"><a href="./RubyLsp/TestHelper.html">TestHelper</a></li><li class="index-entry"><a href="./RubyLsp/TypeInferrer.html">TypeInferrer</a></li>
    </ul>
  </details>
</li>
<li class="expandable-index-entry">
  <details>
    <summary><a href="./URI.html">URI</a></summary>
    <ul>
      <li class="index-entry"><a href="./URI/Generic.html">Generic</a></li><li class="index-entry"><a href="./URI/Source.html">Source</a></li>
    </ul>
  </details>
</li>

  </ul>
</nav>

  <article>
<h1 id="label-Ruby+LSP+addons">Ruby LSP addons<span><a href="#label-Ruby+LSP+addons">&para;</a> <a href="#top">&uarr;</a></span></h1>

<blockquote>
<p>[!WARNING] The Ruby LSP addon system is currently experimental and subject to changes in the API</p>
</blockquote>

<p>Need help writing addons? Consider joining the ruby-lsp-addons channel in the <a href="https://join.slack.com/t/ruby-dx/shared_invite/zt-2c8zjlir6-uUDJl8oIwcen_FS_aA~b6Q">Ruby DX Slack workspace</a>.</p>

<h2 id="label-Motivation+and+goals">Motivation and goals<span><a href="#label-Motivation+and+goals">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Editor features that are specific to certain tools or frameworks can be incredibly powerful. Typically, language servers are aimed at providing features for a particular programming language (like Ruby!) and not specific tools. This is reasonable since not every programmer uses the same combination of tools.</p>

<p>Including tool specific functionality in the Ruby LSP would not scale well given the large number of tools in the ecosystem. It would also create a bottleneck for authors to push new features. Building separate tooling, on the other hand, increases fragmentation which tends to increase the effort required by users to configure their development environments.</p>

<p>For these reasons, the Ruby LSP ships with an addon system that authors can use to enhance the behavior of the base LSP with tool specific functionality, aimed at</p>
<ul><li>
<p>Allowing gem authors to export Ruby LSP addons from their own gems</p>
</li><li>
<p>Allowing LSP features to be enhanced by addons present in the application the developer is currently working on</p>
</li><li>
<p>Not requiring extra configuration from the user</p>
</li><li>
<p>Seamlessly integrating with the base features of the Ruby LSP</p>
</li></ul>

<h2 id="label-Guidelines">Guidelines<span><a href="#label-Guidelines">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>When building a Ruby LSP addon, refer to these guidelines to ensure a good developer experience.</p>
<ul><li>
<p>Performance over features. A single slow request may result in lack of responsiveness in the editor</p>
</li><li>
<p>There are two types of LSP requests: automatic (e.g.: semantic highlighting) and user initiated (go to definition). The performance of automatic requests is critical for responsiveness as they are executed every time the user types</p>
</li><li>
<p>Avoid duplicate work where possible. If something can be computed once and memoized, like configurations, do it</p>
</li><li>
<p>Do not mutate LSP state directly. Addons sometimes have access to important state such as document objects, which should never be mutated directly, but instead through the mechanisms provided by the LSP specification - like text edits</p>
</li><li>
<p>Do not overnotify users. It’s generally annoying and diverts attention from the current task</p>
</li></ul>

<h2 id="label-Building+a+Ruby+LSP+addon">Building a Ruby LSP addon<span><a href="#label-Building+a+Ruby+LSP+addon">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p><strong>Note</strong>: the Ruby LSP uses <a href="https://sorbet.org/">Sorbet</a>. We recommend using Sorbet in addons as well, which allows authors to benefit from types declared by the Ruby LSP.</p>

<p>As an example, check out <a href="https://github.com/Shopify/ruby-lsp-rails">Ruby LSP Rails</a>, which is a Ruby LSP addon to provide Rails related features.</p>

<h3 id="label-Activating+the+addon">Activating the addon<span><a href="#label-Activating+the+addon">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>The Ruby LSP discovers addons based on the existence of an <code>addon.rb</code> file placed inside a <code>ruby_lsp</code> folder. For example, <code>my_gem/lib/ruby_lsp/my_gem/addon.rb</code>. This file must declare the addon class, which can be used to perform any necessary activation when the server starts.</p>

<pre class="ruby"><span class="ruby-comment"># frozen_string_literal: true</span>

<span class="ruby-identifier">require</span> <span class="ruby-string">&quot;ruby_lsp/addon&quot;</span>

<span class="ruby-keyword">module</span> <span class="ruby-constant">RubyLsp</span>
  <span class="ruby-keyword">module</span> <span class="ruby-constant">MyGem</span>
    <span class="ruby-keyword">class</span> <span class="ruby-constant">Addon</span> <span class="ruby-operator">&lt;</span> <span class="ruby-operator">::</span><span class="ruby-constant">RubyLsp</span><span class="ruby-operator">::</span><span class="ruby-constant">Addon</span>
      <span class="ruby-comment"># Performs any activation that needs to happen once when the language server is booted</span>
      <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">activate</span>(<span class="ruby-identifier">global_state</span>, <span class="ruby-identifier">message_queue</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment"># Performs any cleanup when shutting down the server, like terminating a subprocess</span>
      <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">deactivate</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment"># Returns the name of the addon</span>
      <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">name</span>
        <span class="ruby-string">&quot;Ruby LSP My Gem&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Listeners">Listeners<span><a href="#label-Listeners">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>An essential component to addons are listeners. All Ruby LSP requests are listeners that handle specific node types.</p>

<p>Listeners work in conjunction with a <code>Prism::Dispatcher</code>, which is responsible for dispatching events during the parsing of Ruby code. Each event corresponds to a specific node in the Abstract Syntax Tree (AST) of the code being parsed.</p>

<p>Here’s a simple example of a listener:</p>

<pre class="ruby"><span class="ruby-comment"># frozen_string_literal: true</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">MyListener</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">dispatcher</span>)
    <span class="ruby-comment"># Register to listen to `on_class_node_enter` events</span>
    <span class="ruby-identifier">dispatcher</span>.<span class="ruby-identifier">register</span>(<span class="ruby-keyword">self</span>, <span class="ruby-value">:on_class_node_enter</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Define the handler method for the `on_class_node_enter` event</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">on_class_node_enter</span>(<span class="ruby-identifier">node</span>)
    <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Hello, #{node.constant_path.slice}!&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">dispatcher</span> = <span class="ruby-constant">Prism</span><span class="ruby-operator">::</span><span class="ruby-constant">Dispatcher</span>.<span class="ruby-identifier">new</span>
<span class="ruby-constant">MyListener</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">dispatcher</span>)

<span class="ruby-identifier">parse_result</span> = <span class="ruby-constant">Prism</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-string">&quot;class Foo; end&quot;</span>)
<span class="ruby-identifier">dispatcher</span>.<span class="ruby-identifier">dispatch</span>(<span class="ruby-identifier">parse_result</span>.<span class="ruby-identifier">value</span>)

<span class="ruby-comment"># Prints</span>
<span class="ruby-comment"># =&gt; Hello, Foo!</span>
</pre>

<p>In this example, the listener is registered to the dispatcher to listen for the <code>:on_class_node_enter</code> event. When a class node is encountered during the parsing of the code, a greeting message is outputted with the class name.</p>

<p>This approach enables all addon responses to be captured in a single round of AST visits, greatly improving performance.</p>

<h3 id="label-Enhancing+features">Enhancing features<span><a href="#label-Enhancing+features">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>To enhance a request, the addon must create a listener that will collect extra results that will be automatically appended to the base language server response. Additionally, <code>Addon</code> has to implement a factory method that instantiates the listener. When instantiating the listener, also note that a <code>ResponseBuilders</code> object is passed in. This object should be used to return responses back to the Ruby LSP.</p>

<p>For example: to add a message on hover saying “Hello!” on top of the base hover behavior of the Ruby LSP, we can use the following listener implementation.</p>

<pre class="ruby"><span class="ruby-comment"># frozen_string_literal: true</span>

<span class="ruby-keyword">module</span> <span class="ruby-constant">RubyLsp</span>
  <span class="ruby-keyword">module</span> <span class="ruby-constant">MyGem</span>
    <span class="ruby-keyword">class</span> <span class="ruby-constant">Addon</span> <span class="ruby-operator">&lt;</span> <span class="ruby-operator">::</span><span class="ruby-constant">RubyLsp</span><span class="ruby-operator">::</span><span class="ruby-constant">Addon</span>
      <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">activate</span>(<span class="ruby-identifier">global_state</span>, <span class="ruby-identifier">message_queue</span>)
        <span class="ruby-ivar">@message_queue</span> = <span class="ruby-identifier">message_queue</span>
        <span class="ruby-ivar">@config</span> = <span class="ruby-constant">SomeConfiguration</span>.<span class="ruby-identifier">new</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">deactivate</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">name</span>
        <span class="ruby-string">&quot;Ruby LSP My Gem&quot;</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">create_hover_listener</span>(<span class="ruby-identifier">response_builder</span>, <span class="ruby-identifier">node_context</span>, <span class="ruby-identifier">index</span>, <span class="ruby-identifier">dispatcher</span>)
        <span class="ruby-comment"># Use the listener factory methods to instantiate listeners with parameters sent by the LSP combined with any</span>
        <span class="ruby-comment"># pre-computed information in the addon. These factory methods are invoked on every request</span>
        <span class="ruby-constant">Hover</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">client</span>, <span class="ruby-identifier">response_builder</span>, <span class="ruby-ivar">@config</span>, <span class="ruby-identifier">dispatcher</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">class</span> <span class="ruby-constant">Hover</span>
      <span class="ruby-comment"># The Requests::Support::Common module provides some helper methods you may find helpful.</span>
      <span class="ruby-identifier">include</span> <span class="ruby-constant">Requests</span><span class="ruby-operator">::</span><span class="ruby-constant">Support</span><span class="ruby-operator">::</span><span class="ruby-constant">Common</span>

      <span class="ruby-comment"># Listeners are initialized with the Prism::Dispatcher. This object is used by the Ruby LSP to emit the events</span>
      <span class="ruby-comment"># when it finds nodes during AST analysis. Listeners must register which nodes they want to handle with the</span>
      <span class="ruby-comment"># dispatcher (see below).</span>
      <span class="ruby-comment"># Listeners are initialized with a `ResponseBuilders` object. The listener will push the associated content</span>
      <span class="ruby-comment"># to this object, which will then build the Ruby LSP&#39;s response.</span>
      <span class="ruby-comment"># Additionally, listeners are instantiated with a message_queue to push notifications (not used in this example).</span>
      <span class="ruby-comment"># See &quot;Sending notifications to the client&quot; for more information.</span>
      <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">client</span>, <span class="ruby-identifier">response_builder</span>, <span class="ruby-identifier">config</span>, <span class="ruby-identifier">dispatcher</span>)
        <span class="ruby-keyword">super</span>(<span class="ruby-identifier">dispatcher</span>)

        <span class="ruby-ivar">@client</span> = <span class="ruby-identifier">client</span>
        <span class="ruby-ivar">@response_builder</span> = <span class="ruby-identifier">response_builder</span>
        <span class="ruby-ivar">@config</span> = <span class="ruby-identifier">config</span>

        <span class="ruby-comment"># Register that this listener will handle `on_constant_read_node_enter` events (i.e.: whenever a constant read</span>
        <span class="ruby-comment"># is found in the code)</span>
        <span class="ruby-identifier">dispatcher</span>.<span class="ruby-identifier">register</span>(<span class="ruby-keyword">self</span>, <span class="ruby-value">:on_constant_read_node_enter</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment"># Listeners must define methods for each event they registered with the dispatcher. In this case, we have to</span>
      <span class="ruby-comment"># define `on_constant_read_node_enter` to specify what this listener should do every time we find a constant</span>
      <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">on_constant_read_node_enter</span>(<span class="ruby-identifier">node</span>)
        <span class="ruby-comment"># Certain builders are made available to listeners to build LSP responses. The classes under</span>
        <span class="ruby-comment"># `RubyLsp::ResponseBuilders` are used to build responses conforming to the LSP Specification.</span>
        <span class="ruby-comment"># ResponseBuilders::Hover itself also requires a content category to be specified (title, links,</span>
        <span class="ruby-comment"># or documentation).</span>
        <span class="ruby-ivar">@response_builder</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">&quot;Hello!&quot;</span>, <span class="ruby-value">category:</span> <span class="ruby-value">:documentation</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Registering+formatters">Registering formatters<span><a href="#label-Registering+formatters">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Gems may also provide a formatter to be used by the Ruby LSP. To do that, the addon must create a formatter runner and register it. The formatter is used if the <code>rubyLsp.formatter</code> option configured by the user matches the identifier registered.</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">MyFormatterRubyLspAddon</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">RubyLsp</span><span class="ruby-operator">::</span><span class="ruby-constant">Addon</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">name</span>
    <span class="ruby-string">&quot;My Formatter&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">activate</span>(<span class="ruby-identifier">global_state</span>, <span class="ruby-identifier">message_queue</span>)
    <span class="ruby-comment"># The first argument is an identifier users can pick to select this formatter. To use this formatter, users must</span>
    <span class="ruby-comment"># have rubyLsp.formatter configured to &quot;my_formatter&quot;</span>
    <span class="ruby-comment"># The second argument is a class instance that implements the `FormatterRunner` interface (see below)</span>
    <span class="ruby-identifier">global_state</span>.<span class="ruby-identifier">register_formatter</span>(<span class="ruby-string">&quot;my_formatter&quot;</span>, <span class="ruby-constant">MyFormatterRunner</span>.<span class="ruby-identifier">new</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment"># Custom formatter</span>
<span class="ruby-keyword">class</span> <span class="ruby-constant">MyFormatter</span>
  <span class="ruby-comment"># If using Sorbet to develop the addon, then include this interface to make sure the class is properly implemented</span>
  <span class="ruby-identifier">include</span> <span class="ruby-constant">RubyLsp</span><span class="ruby-operator">::</span><span class="ruby-constant">Requests</span><span class="ruby-operator">::</span><span class="ruby-constant">Support</span><span class="ruby-operator">::</span><span class="ruby-constant">Formatter</span>

  <span class="ruby-comment"># Use the initialize method to perform any sort of ahead of time work. For example, reading configurations for your</span>
  <span class="ruby-comment"># formatter since they are unlikely to change between requests</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>
    <span class="ruby-ivar">@config</span> = <span class="ruby-identifier">read_config_file!</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># IMPORTANT: None of the following methods should mutate the document in any way or that will lead to a corrupt state!</span>

  <span class="ruby-comment"># Provide formatting for a given document. This method should return the formatted string for the entire document</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">run_formatting</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">document</span>)
    <span class="ruby-identifier">source</span> = <span class="ruby-identifier">document</span>.<span class="ruby-identifier">source</span>
    <span class="ruby-identifier">formatted_source</span> = <span class="ruby-identifier">format_the_source_using_my_formatter</span>(<span class="ruby-identifier">source</span>)
    <span class="ruby-identifier">formatted_source</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Provide diagnostics for the given document. This method must return an array of `RubyLsp::Interface::Diagnostic`</span>
  <span class="ruby-comment"># objects</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">run_diagnostic</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">document</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Sending+notifications+to+the+client">Sending notifications to the client<span><a href="#label-Sending+notifications+to+the+client">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Sometimes, addons may need to send asynchronous information to the client. For example, a slow request might want to indicate progress or diagnostics may be computed in the background without blocking the language server.</p>

<p>For this purpose, all addons receive the message queue when activated, which is a thread queue that can receive notifications for the client. The addon should keep a reference to this message queue and pass it to listeners that are interested in using it.</p>

<p><strong>Note</strong>: do not close the message queue anywhere. The Ruby LSP will handle closing the message queue when appropriate.</p>

<pre class="ruby"><span class="ruby-keyword">module</span> <span class="ruby-constant">RubyLsp</span>
  <span class="ruby-keyword">module</span> <span class="ruby-constant">MyGem</span>
    <span class="ruby-keyword">class</span> <span class="ruby-constant">Addon</span> <span class="ruby-operator">&lt;</span> <span class="ruby-operator">::</span><span class="ruby-constant">RubyLsp</span><span class="ruby-operator">::</span><span class="ruby-constant">Addon</span>
      <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">activate</span>(<span class="ruby-identifier">global_state</span>, <span class="ruby-identifier">message_queue</span>)
        <span class="ruby-ivar">@message_queue</span> = <span class="ruby-identifier">message_queue</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">deactivate</span>; <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">name</span>
        <span class="ruby-string">&quot;Ruby LSP My Gem&quot;</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">create_hover_listener</span>(<span class="ruby-identifier">response_builder</span>, <span class="ruby-identifier">node_context</span>, <span class="ruby-identifier">index</span>, <span class="ruby-identifier">dispatcher</span>)
        <span class="ruby-constant">MyHoverListener</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@message_queue</span>, <span class="ruby-identifier">response_builder</span>, <span class="ruby-identifier">node_context</span>, <span class="ruby-identifier">index</span>, <span class="ruby-identifier">dispatcher</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">class</span> <span class="ruby-constant">MyHoverListener</span>
      <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">message_queue</span>, <span class="ruby-identifier">response_builder</span>, <span class="ruby-identifier">node_context</span>, <span class="ruby-identifier">index</span>, <span class="ruby-identifier">dispatcher</span>)
        <span class="ruby-ivar">@message_queue</span> = <span class="ruby-identifier">message_queue</span>

        <span class="ruby-ivar">@message_queue</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Notification</span>.<span class="ruby-identifier">new</span>(
          <span class="ruby-value">message:</span> <span class="ruby-string">&quot;$/progress&quot;</span>,
          <span class="ruby-value">params:</span> <span class="ruby-constant">Interface</span><span class="ruby-operator">::</span><span class="ruby-constant">ProgressParams</span>.<span class="ruby-identifier">new</span>(
            <span class="ruby-value">token:</span> <span class="ruby-string">&quot;progress-token-id&quot;</span>,
            <span class="ruby-value">value:</span> <span class="ruby-constant">Interface</span><span class="ruby-operator">::</span><span class="ruby-constant">WorkDoneProgressBegin</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">kind:</span> <span class="ruby-string">&quot;begin&quot;</span>, <span class="ruby-value">title:</span> <span class="ruby-string">&quot;Starting slow work!&quot;</span>),
          ),
        )
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Registering+for+file+update+events">Registering for file update events<span><a href="#label-Registering+for+file+update+events">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>By default, the Ruby LSP listens for changes to files ending in <code>.rb</code> to continuously update its index when Ruby source code is modified. If your addon uses a tool that is configured through a file (like <a href="RuboCop.html"><code>RuboCop</code></a> and its <code>.rubocop.yml</code>) you can register for changes to these files and react when the configuration changes.</p>

<p><strong>Note</strong>: you will receive events from <code>ruby-lsp</code> and other addons as well, in addition to your own registered ones.</p>

<pre class="ruby"><span class="ruby-keyword">module</span> <span class="ruby-constant">RubyLsp</span>
  <span class="ruby-keyword">module</span> <span class="ruby-constant">MyGem</span>
    <span class="ruby-keyword">class</span> <span class="ruby-constant">Addon</span> <span class="ruby-operator">&lt;</span> <span class="ruby-operator">::</span><span class="ruby-constant">RubyLsp</span><span class="ruby-operator">::</span><span class="ruby-constant">Addon</span>
      <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">activate</span>(<span class="ruby-identifier">global_state</span>, <span class="ruby-identifier">message_queue</span>)
        <span class="ruby-identifier">register_additional_file_watchers</span>(<span class="ruby-identifier">global_state</span>, <span class="ruby-identifier">message_queue</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">deactivate</span>; <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">register_additional_file_watchers</span>(<span class="ruby-identifier">global_state</span>, <span class="ruby-identifier">message_queue</span>)
        <span class="ruby-comment"># Clients are not required to implement this capability</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">global_state</span>.<span class="ruby-identifier">supports_watching_files</span>

        <span class="ruby-identifier">message_queue</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Request</span>.<span class="ruby-identifier">new</span>(
          <span class="ruby-value">id:</span> <span class="ruby-string">&quot;ruby-lsp-my-gem-file-watcher&quot;</span>,
          <span class="ruby-value">method:</span> <span class="ruby-string">&quot;client/registerCapability&quot;</span>,
          <span class="ruby-value">params:</span> <span class="ruby-constant">Interface</span><span class="ruby-operator">::</span><span class="ruby-constant">RegistrationParams</span>.<span class="ruby-identifier">new</span>(
            <span class="ruby-value">registrations:</span> [
              <span class="ruby-constant">Interface</span><span class="ruby-operator">::</span><span class="ruby-constant">Registration</span>.<span class="ruby-identifier">new</span>(
                <span class="ruby-value">id:</span> <span class="ruby-string">&quot;workspace/didChangeWatchedFilesMyGem&quot;</span>,
                <span class="ruby-value">method:</span> <span class="ruby-string">&quot;workspace/didChangeWatchedFiles&quot;</span>,
                <span class="ruby-value">register_options:</span> <span class="ruby-constant">Interface</span><span class="ruby-operator">::</span><span class="ruby-constant">DidChangeWatchedFilesRegistrationOptions</span>.<span class="ruby-identifier">new</span>(
                  <span class="ruby-value">watchers:</span> [
                    <span class="ruby-constant">Interface</span><span class="ruby-operator">::</span><span class="ruby-constant">FileSystemWatcher</span>.<span class="ruby-identifier">new</span>(
                      <span class="ruby-value">glob_pattern:</span> <span class="ruby-string">&quot;**/.my-config.yml&quot;</span>,
                      <span class="ruby-value">kind:</span> <span class="ruby-constant">Constant</span><span class="ruby-operator">::</span><span class="ruby-constant">WatchKind</span><span class="ruby-operator">::</span><span class="ruby-constant">CREATE</span> <span class="ruby-operator">|</span> <span class="ruby-constant">Constant</span><span class="ruby-operator">::</span><span class="ruby-constant">WatchKind</span><span class="ruby-operator">::</span><span class="ruby-constant">CHANGE</span> <span class="ruby-operator">|</span> <span class="ruby-constant">Constant</span><span class="ruby-operator">::</span><span class="ruby-constant">WatchKind</span><span class="ruby-operator">::</span><span class="ruby-constant">DELETE</span>,
                    ),
                  ],
                ),
              ),
            ],
          ),
        )
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">workspace_did_change_watched_files</span>(<span class="ruby-identifier">changes</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">changes</span>.<span class="ruby-identifier">any?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">change</span><span class="ruby-operator">|</span> <span class="ruby-identifier">change</span>[<span class="ruby-value">:uri</span>].<span class="ruby-identifier">end_with?</span>(<span class="ruby-string">&quot;.my-config.yml&quot;</span>) }
          <span class="ruby-comment"># Do something to reload the config here</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Ensuring+consistent+documentation">Ensuring consistent documentation<span><a href="#label-Ensuring+consistent+documentation">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>The Ruby LSP exports a Rake task to help authors make sure all of their listeners are documented and include demos and examples of the feature in action. Configure the Rake task and run <code>bundle exec rake ruby_lsp:check_docs</code> on CI to ensure documentation is always up to date and consistent.</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&quot;ruby_lsp/check_docs&quot;</span>

<span class="ruby-comment"># The first argument is the file list including all of the listeners declared by the addon</span>
<span class="ruby-comment"># The second argument is the file list of GIF files with the demos of all listeners</span>
<span class="ruby-constant">RubyLsp</span><span class="ruby-operator">::</span><span class="ruby-constant">CheckDocs</span>.<span class="ruby-identifier">new</span>(
  <span class="ruby-constant">FileList</span>[<span class="ruby-node">&quot;#{__dir__}/lib/ruby_lsp/ruby_lsp_rails/**/*.rb&quot;</span>],
  <span class="ruby-constant">FileList</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;#{__dir__}/misc/**/*.gif&quot;</span>),
)
</pre>

<h3 id="label-Dependency+constraints">Dependency constraints<span><a href="#label-Dependency+constraints">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>While we figure out a good design for the addons API, breaking changes are bound to happen. To avoid having your addon accidentally break editor functionality, always restrict the dependency on the <code>ruby-lsp</code> gem based on minor versions (breaking changes may land on minor versions until we reach v1.0.0).</p>

<pre class="ruby"><span class="ruby-identifier">spec</span>.<span class="ruby-identifier">add_dependency</span>(<span class="ruby-string">&quot;ruby-lsp&quot;</span>, <span class="ruby-string">&quot;~&gt; 0.6.0&quot;</span>)
</pre>

<h3 id="label-Testing+addons">Testing addons<span><a href="#label-Testing+addons">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>When writing unit tests for addons, it’s essential to keep in mind that code is rarely in its final state while the developer is coding. Therefore, be sure to test valid scenarios where the code is still incomplete.</p>

<p>For example, if you are writing a feature related to <code>require</code>, do not test <code>require &quot;library&quot;</code> exclusively. Consider intermediate states the user might end up while typing. Additionally, consider syntax that is uncommon, yet still valid Ruby.</p>

<pre class="ruby"><span class="ruby-comment"># Still no argument</span>
<span class="ruby-identifier">require</span>

<span class="ruby-comment"># With quotes autocompleted, but no content on the string</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&quot;&quot;</span>

<span class="ruby-comment"># Using uncommon, but valid syntax, such as invoking require directly on Kernel using parenthesis</span>
<span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">require</span>(<span class="ruby-string">&quot;library&quot;</span>)
</pre>
</article>
  <div class="right-section">
  <nav class="right-nav">
    <span id="right-side-bar-title" class="right-side-bar-title">On this page</span>
      <ul>
        <li> <a href=#>ADDONS.md</a></li>

            <div class="nav-section">

              <ul class="link-list" role="directory">
                                    <li>
                      <details open>
                        <summary>                <a href="#label-Ruby+LSP+addons">Ruby LSP addons</a>
</summary>
                        <ul class="link-list" role="directory">
                                              <li>                <a href="#label-Motivation+and+goals">Motivation and goals</a>
                    <li>                <a href="#label-Guidelines">Guidelines</a>
                    <li>
                      <details open>
                        <summary>                <a href="#label-Building+a+Ruby+LSP+addon">Building a Ruby LSP addon</a>
</summary>
                        <ul class="link-list" role="directory">
                                              <li>                <a href="#label-Activating+the+addon">Activating the addon</a>
                    <li>                <a href="#label-Listeners">Listeners</a>
                    <li>                <a href="#label-Enhancing+features">Enhancing features</a>
                    <li>                <a href="#label-Registering+formatters">Registering formatters</a>
                    <li>                <a href="#label-Sending+notifications+to+the+client">Sending notifications to the client</a>
                    <li>                <a href="#label-Registering+for+file+update+events">Registering for file update events</a>
                    <li>                <a href="#label-Ensuring+consistent+documentation">Ensuring consistent documentation</a>
                    <li>                <a href="#label-Dependency+constraints">Dependency constraints</a>
                    <li>                <a href="#label-Testing+addons">Testing addons</a>

                        </ul>
                      </details>
                    </li>

                        </ul>
                      </details>
                    </li>

              </ul>
            </div>
  </nav>
</div>

</div>

<div id="search-modal">
  <div id="search-modal-content">
    <input id="search-modal-input" type="text" placeholder="Search"></input>
    <ul id="search-results"></ul>
  </div>
</div>


    <footer>
      <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.6.3.1
    </footer>
  </body>
</html>
